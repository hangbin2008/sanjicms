version: '3.8'

services:
  # 应用程序服务
  app:
    image: ghcr.io/hangbin2008/sanjicms:latest
    ports:
      - "${SERVER_PORT:-8080}:${SERVER_PORT:-8080}"
    environment:
      # 服务器配置
      - SERVER_HOST=${SERVER_HOST:-0.0.0.0}
      - SERVER_PORT=${SERVER_PORT:-8080}
      # 数据库配置
      - DB_HOST=${DB_HOST:-db}
      - DB_PORT=${DB_PORT:-3306}
      - DB_USER=${DB_USER:-root}
      - DB_PASSWORD=${DB_PASSWORD:-your-db-password}
      - DB_NAME=${DB_NAME:-jiceng_sanji_exam}
      - DB_CHARSET=${DB_CHARSET:-utf8mb4}
      # JWT配置
      - JWT_SECRET=${JWT_SECRET:-your-jwt-secret-key}
      - JWT_EXPIRES_IN=${JWT_EXPIRES_IN:-3600}
      # 密码配置
      - PASSWORD_MIN_LENGTH=${PASSWORD_MIN_LENGTH:-8}
      - PASSWORD_REQUIRE_LETTER=${PASSWORD_REQUIRE_LETTER:-true}
      - PASSWORD_REQUIRE_DIGIT=${PASSWORD_REQUIRE_DIGIT:-true}
      - PASSWORD_REQUIRE_SPECIAL=${PASSWORD_REQUIRE_SPECIAL:-true}
    depends_on:
      - db
    restart: always

  # MySQL数据库服务
  db:
    image: mysql:5.7
    ports:
      - "${DB_PORT:-3306}:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD:-your-db-password}
      - MYSQL_DATABASE=${DB_NAME:-jiceng_sanji_exam}
      - MYSQL_CHARSET=${DB_CHARSET:-utf8mb4}
      - MYSQL_COLLATION=utf8mb4_unicode_ci
    volumes:
      # 挂载数据库数据目录
      - db_data:/var/lib/mysql
      # 挂载初始化脚本
      - ./migrations:/docker-entrypoint-initdb.d
    restart: always

volumes:
  db_data: